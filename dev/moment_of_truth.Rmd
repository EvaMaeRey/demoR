---
title: "Untitled"
author: "Kelly Bodwin"
date: "July 11, 2019"
output: html_document
---

```{r, echo = FALSE, message = FALSE}

library(purrr)
library(rlang)
library(knitr)

retrieve_demos <- function(envir) {

  my_demos <- map(ls(envir), function(x) if (class(env_get(envir, x)) == "demo_code") return(x) ) %>% unlist()

  return(my_demos)
}

# 
# knitr::knit_hooks$set(
#   demo = function(before, options, envir) {
#     
#     if (!before) {
#       
#       #my_demos <- retrieve_demos(envir)
#       #map(to_evaluate, ~knit_print(eval(.x)))
#       #print(ls(envir))
#       thing <- rlang::env_get(envir, "current_demo_object")
#       
#       if (!is.null(thing)) {
#         
#         thing_evaled <- evaluate::evaluate(thing)
#         
#         if (class(thing_evaled[[2]]) == "recordedplot"
#       
#       return()
#       #return()
#       
#     }
# 
#   }
# )
```



```{r, echo = FALSE, message = FALSE, demo = TRUE}
library(tidyverse)
#library(demoR)
library(knitr)
library(highr)

source("../R/txt_style.R")
source("../R/highlight.R")
source("../R/demo.R")
source("../R/utils-wrap.R")

# # define a method for objects of the class demo_code
knit_print.demo_code <- function(x, ...) {
  
  my_output <- knitr:::wrap(evaluate::evaluate(x)[[2]], ...)

  asis_output(paste(attr(x, "print_string"), my_output))

}


# 
# bob <- expr(mean(1:10))
# 
# ugh <- function(x){
# 
#   toString(ensym(x))
# 
# }
# 
# ugh(bob)

# hilight.demo_code <- function(x) {
#   
#   attr(x, "print_string")
#   
# }


# 
# 
# # register the method
registerS3method("knit_print", "demo_code", knit_print.demo_code)
#registerS3method("hlt_regexp", "demo_code", hlt_regexp.demo_code)
#registerS3method("hilight", "demo_code", hilight.demo_code)




bob <- demo_code({
  ggplot(iris, aes(x = Sepal.Length, y = Petal.Length, color = Species)) + geom_point()
}) %>%
  hlt_args() %>%
  hlt_funs(color = "blue", bold = TRUE) %>%
  hlt_input_vals(color = "red", italics = TRUE) %>%
  hlt_regexp("Sepal.Length", color = "green")

bob

```

```{r, demo = TRUE}

demo_code(mean(1:10)) %>% hlt_input_vals()
```


